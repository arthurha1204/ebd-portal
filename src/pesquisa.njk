---
layout: base.njk
title: Pesquisar
---

<main style="padding-top: 3rem; min-height: 80vh;">
    <div class="container">
        <h1 style="margin-bottom: 2rem; font-family: 'Inter', sans-serif;">Pesquisar Conteúdo</h1>

        <div style="background: #fff; padding: 1.5rem; border-radius: 8px; border: 1px solid #e2e8f0; margin-bottom: 2rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div>
                <label style="display: block; font-size: 0.8rem; font-weight: bold; margin-bottom: 0.5rem;">Buscar termo</label>
                <input type="text" id="searchInput" placeholder="Título, autor..." style="width: 100%; padding: 0.6rem; border: 1px solid #cbd5e1; border-radius: 4px;">
            </div>
            <div>
                <label style="display: block; font-size: 0.8rem; font-weight: bold; margin-bottom: 0.5rem;">Filtrar por Tag</label>
                <select id="tagSelect" style="width: 100%; padding: 0.6rem; border: 1px solid #cbd5e1; border-radius: 4px;">
                    <option value="">Todas as Tags</option>
                </select>
            </div>
            <div>
                <label style="display: block; font-size: 0.8rem; font-weight: bold; margin-bottom: 0.5rem;">Tipo de Conteúdo</label>
                <select id="typeSelect" style="width: 100%; padding: 0.6rem; border: 1px solid #cbd5e1; border-radius: 4px;">
                    <option value="">Todos</option>
                    <option value="artigo">Artigos</option>
                    <option value="aula">Aulas</option>
                    <option value="video">Vídeos</option>
                    <option value="livro">Livros</option>
                </select>
            </div>
        </div>

        <div id="resultsInfo" style="margin-bottom: 1rem; color: #666;">Carregando...</div>
        
        <div id="resultsGrid" class="feed-grid"></div>
    </div>
</main>

<script>
    let allContent = [];

    async function initSearch() {
        // Pega o índice JSON
        const response = await fetch('/search-index.json');
        allContent = await response.json();
        
        // Popula as tags
        const allTags = new Set();
        allContent.forEach(item => {
            if(item.tags) item.tags.forEach(t => allTags.add(t));
        });
        const tagSelect = document.getElementById('tagSelect');
        Array.from(allTags).sort().forEach(tag => {
            if(tag !== 'post' && tag !== 'artigo' && tag !== 'aula' && tag !== 'video') {
                const opt = document.createElement('option');
                opt.value = tag;
                opt.innerText = tag;
                tagSelect.appendChild(opt);
            }
        });

        // Verifica URL para filtro direto (?tag=Teologia)
        const urlParams = new URLSearchParams(window.location.search);
        const tagParam = urlParams.get('tag');
        if(tagParam) {
            document.getElementById('tagSelect').value = tagParam;
        }

        filterResults();
    }

    function filterResults() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        const tag = document.getElementById('tagSelect').value;
        const type = document.getElementById('typeSelect').value;

        const filtered = allContent.filter(item => {
            const matchTerm = item.title.toLowerCase().includes(term) || item.author.toLowerCase().includes(term);
            const matchTag = tag === "" || (item.tags && item.tags.includes(tag));
            const matchType = type === "" || item.url.includes(`/${type}s/`); 
            return matchTerm && matchTag && matchType;
        });

        renderResults(filtered);
    }

    function renderResults(items) {
        const grid = document.getElementById('resultsGrid');
        document.getElementById('resultsInfo').innerText = `${items.length} resultados encontrados.`;
        grid.innerHTML = '';

        items.forEach(item => {
            let label = "CONTEÚDO";
            let badgeColor = "var(--primary-color)";
            if(item.url.includes("/videos/")) { label = "VÍDEO"; badgeColor = "#ef4444"; }
            else if(item.url.includes("/aulas/")) { label = "AULA"; badgeColor = "var(--accent-color)"; }

            const html = `
                <div class="card">
                    <div style="height: 180px; position: relative; overflow:hidden;">
                        <span style="position: absolute; top: 10px; left: 10px; background: ${badgeColor}; color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 800; text-transform: uppercase;">${label}</span>
                        <img src="${item.image}" style="width:100%; height:100%; object-fit:cover;">
                    </div>
                    <div class="card-body">
                        <h3 style="font-size: 1.1rem; margin-top: 0.5rem;">${item.title}</h3>
                        <p style="font-size: 0.85rem; color: #64748B;">${item.date} • ${item.author}</p>
                        <a href="${item.url}" class="btn btn-outline" style="width: 100%; margin-top: auto;">VER CONTEÚDO</a>
                    </div>
                </div>
            `;
            grid.innerHTML += html;
        });
    }

    document.getElementById('searchInput').addEventListener('input', filterResults);
    document.getElementById('tagSelect').addEventListener('change', filterResults);
    document.getElementById('typeSelect').addEventListener('change', filterResults);

    initSearch();
</script>